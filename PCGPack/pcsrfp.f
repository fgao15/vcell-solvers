      SUBROUTINEPCSRFP(N,IJA,A,RHS,ISP,RSP,LINK,IPTR,IC,C,
     *NBLACK,D2I,NZRS,IJRS,RS,RSRHS,Y,IMN,ISCR,RSNADR,NSP1)
      IMPLICITDOUBLEPRECISION(A-H,O-Z)
      INTEGERN,IJA(*),ISP(*),LINK,IPTR,IC,C,NBLACK,D2I,NZRS,
     *IJRS,RS,RSRHS,Y,IMN,ISCR,RSNADR,NSP1
      DOUBLEPRECISIONA(*),RHS(*),RSP(*)
      INTEGERIERR,ITMAX,ITEST,KMAX,IFL,IPRE,PBLK,LUDONE,IBLK,
     *MNEED,ITS,RSDONE,NOVERF,RED1,RED2,IERR2,IFRMAT
      COMMON/PCCOM1/IERR,ITMAX,ITEST,KMAX,IFL,IPRE,PBLK,
     *LUDONE,IBLK,MNEED,ITS,RSDONE,NOVERF,RED1,RED2,IERR2,
     *IFRMAT
      SAVE/PCCOM1/
      INTEGERIPRE1,IPRE2,RATIO
      COMMON/PCCOM3/IPRE1,IPRE2,RATIO
      SAVE/PCCOM3/
      LOGICALLOWER,UPPER,FULL,HALF,SYMMAT
      COMMON/PCVERL/LOWER,UPPER,FULL,HALF,SYMMAT
      SAVE/PCVERL/
      INTEGERINADR,NZRSMX,MARK,FIC,IRC,AILAST,NZR,NRED,NSP,
     *NADR
      INTEGERSPACEN,KNZRS,KNRED,SPHALF
      INTEGERALAST
      SPACEN(KNZRS,KNRED,SPHALF)=(2*N+SPHALF+RATIO-1)/RATIO+(KNZRS+
     *RATIO-1)/RATIO+2*N+KNZRS
      NADR=ISP(2)
      INADR=(NADR-1)*RATIO+1
      ALAST=NADR+ISP(1)
      NSP=ALAST-1
      IF(RSDONE.EQ.0)THEN
      NZR=IJA(N+1)-1
      IC=INADR
      C=IC+N
      NADR=(C+N+RATIO-1)/RATIO+1
      INADR=C+N
      IF(HALF)THEN
      SPHALF=2*NZR
      LINK=C+N
      IPTR=LINK+NZR
      NADR=(IPTR+NZR+RATIO-1)/RATIO+1
      INADR=IPTR+NZR
      IF(NADR.LE.NSP)THEN
      CALLPCICTR(N,IJA,ISP(IPTR),ISP(LINK))
      ENDIF
      ELSE
      SPHALF=0
      LINK=INADR
      IPTR=INADR
      ENDIF
      IF(NADR.GT.NSP)THEN
      NZRS=NZR
      NRED=N/2
      MNEED=MNEED+SPACEN(NZRS,NRED,SPHALF)-ISP(1)
      IERR=10
      RETURN
      ENDIF
      CALLPCSROP(N,IJA,ISP(IPTR),ISP(LINK),NBLACK,ISP(C),ISP(
     *IC))
      NRED=N-NBLACK
      AILAST=(ALAST-1)*RATIO+1
      MARK=AILAST-N
      FIC=MARK-N+NRED
      IJRS=INADR
      NZRSMX=FIC-IJRS
      IF(NZRSMX.LT.NBLACK+1)THEN
      NZRS=NZR
      MNEED=MNEED+SPACEN(NZRS,NRED,SPHALF)-ISP(1)
      IERR=10
      RETURN
      ENDIF
      IF(NBLACK.NE.0)THEN
      IF(HALF)THEN
      CALLPCSRSP(N,NZRSMX,NBLACK,ISP(C),ISP(IC),IJA,ISP
     *(IPTR),ISP(LINK),NZRS,IRC,ISP(IJRS),ISP(MARK),ISP(
     *FIC))
      ELSE
      CALLPCSRZP(N,NZRSMX,NBLACK,ISP(C),ISP(IC),IJA,
     *NZRS,IRC,ISP(IJRS),ISP(MARK),ISP(FIC))
      ENDIF
      IF(IRC.NE.0)THEN
      NZRS=MAX(NZR,NZRSMX+IRC)
      MNEED=MNEED+SPACEN(NZRS,NRED,SPHALF)-ISP(1)
      IERR=10
      RETURN
      ENDIF
      ELSE
      NZRS=0
      ENDIF
      ENDIF
      INADR=IJRS+NZRS
      NADR=(INADR+RATIO-2)/RATIO+1
      RSNADR=NADR
      D2I=ALAST-NRED
      RSRHS=D2I-N+NRED
      RS=RSRHS-NZRS
      Y=RS-N
      IF(Y.LT.NADR)THEN
      MNEED=MNEED+SPACEN(NZRS,NRED,SPHALF)-ISP(1)
      IERR=10
      RETURN
      ENDIF
      MNEED=MNEED+SPACEN(NZRS,NRED,SPHALF)
      IMN=MNEED
      ISCR=0
      CALLPCSBGP(N,NBLACK,ISP(C),ISP(IC),IJA,ISP(LINK),ISP(IPTR)
     *,ISP(IJRS),A,RHS,RSP(D2I),RSP(RSRHS),RSP(RS),RSP(Y))
      NSP1=Y-NADR
      RETURN
      END
