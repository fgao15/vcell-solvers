      SUBROUTINEPCIC1(MODIFY,N,IJA,A,ISP,RSP,IJU,UD)
      IMPLICITDOUBLEPRECISION(A-H,O-Z)
      LOGICALMODIFY
      INTEGERN,IJA(*),ISP(*),IJU,UD
      DOUBLEPRECISIONA(*),RSP(*)
      INTEGERIERR,ITMAX,ITEST,KMAX,IFL,IPRE,PBLK,LUDONE,IBLK,
     *MNEED,ITS,RSDONE,NOVERF,RED1,RED2,IERR2,IFRMAT
      COMMON/PCCOM1/IERR,ITMAX,ITEST,KMAX,IFL,IPRE,PBLK,
     *LUDONE,IBLK,MNEED,ITS,RSDONE,NOVERF,RED1,RED2,IERR2,
     *IFRMAT
      SAVE/PCCOM1/
      INTEGERIPRE1,IPRE2,RATIO
      COMMON/PCCOM3/IPRE1,IPRE2,RATIO
      SAVE/PCCOM3/
      INTEGERISRT,IJASGN,ISX0,IFORM
      COMMON/PCVERI/ISRT,IJASGN,ISX0,IFORM
      SAVE/PCVERI/
      LOGICALLOWER,UPPER,FULL,HALF,SYMMAT
      COMMON/PCVERL/LOWER,UPPER,FULL,HALF,SYMMAT
      SAVE/PCVERL/
      INTEGERROW
      INTEGERANADR,ANFREE,AINADR,ALAST,AILAST,NZA,NZMAX,LEVL,
     *IPT,JL,IFC,NZU,NSP1,SPCN,SCRN,LINKA,IJAR,IUT,MARK
      INTEGERSPIUT,SPJL,SPIFC,SPLEVL,SPIPT,SPMARK,SPLOW,SP1
      INTEGERKNZU,KSPLOW,KSPIUT,KSP1,KSPMAR
      SPCN(KNZU)=(KNZU+RATIO-1)/RATIO+KNZU
      SCRN(KNZU,KSPLOW,KSPIUT,KSP1,KSPMAR)=(KSPLOW+MAX((KSPIUT-
     *RATIO)*KNZU+KSP1*N,(2+KSPMAR+RATIO)*N)+RATIO-1)/RATIO
      IF(IJASGN.EQ.0)THEN
      CALLPCIABS(N,IJA)
      ENDIF
      NZA=IJA(N+1)-1
      IF(MODIFY)THEN
      SPMARK=1
      ELSE
      SPMARK=0
      ENDIF
      IF(LOWER)THEN
      SPLOW=2*NZA
      ELSE
      SPLOW=0
      ENDIF
      IF(IFL.EQ.-1)THEN
      SPIUT=0
      SPIFC=0
      SPJL=0
      SPIPT=0
      SPLEVL=0
      ELSEIF(IFL.EQ.0)THEN
      SPIFC=0
      SPJL=0
      SPIPT=0
      IF(LOWER)THEN
      SPLEVL=1
      SPIUT=0
      ELSE
      IF(ISRT.EQ.1)THEN
      SPLEVL=0
      SPIUT=0
      ELSE
      SPIUT=1
      SPLEVL=1
      ENDIF
      ENDIF
      ELSE
      SPIUT=1
      SPIFC=1
      SPJL=1
      SPIPT=1
      SPLEVL=1
      ENDIF
      SP1=SPJL+SPIFC+SPIPT+SPLEVL
      IF(LUDONE.NE.0)THEN
      NZU=ISP(IJU+N)-1
      IF(LOWER)THEN
      IJAR=IJU+NZU+(2+SPMARK)*N
      LINKA=IJAR+NZA
      CALLPCICTR(N,IJA,ISP(IJAR),ISP(LINKA))
      ENDIF
      ELSE
      ANADR=ISP(2)
      ANFREE=ISP(1)
      AINADR=(ANADR-1)*RATIO+1
      ALAST=ANADR+ANFREE
      AILAST=AINADR+ANFREE*RATIO
      IJU=AINADR
      NZMAX=((AILAST-IJU)-MAX(SP1,2*SPLOW/NZA)*N-SPLOW)/(1+
     *SPIUT)
      IF(NZMAX.LE.0)THEN
      NZU=(NZA-1-N)*(1+IFL)+N
      ISP(1)=ANFREE-SPCN(NZU)
      ISP(3)=ISP(1)-SCRN(NZU,SPLOW,SPIUT,SP1,SPMARK)
      IERR=3
      RETURN
      ENDIF
      JL=IJU+NZMAX
      IFC=JL+SPJL*N
      LEVL=IFC+SPIFC*N
      IPT=LEVL+SPLEVL*N
      IF(LOWER.AND.IFL.GE.0)THEN
      IJAR=JL+MAX(SPJL+SPIFC+SPIPT+SPLEVL,2)*N
      LINKA=IJAR+NZA
      IUT=LINKA+NZA
      CALLPCICTR(N,IJA,ISP(IJAR),ISP(LINKA))
      ELSE
      IJAR=IJU
      LINKA=IJU
      IUT=IPT+SPIPT*N
      ENDIF
      CALLPCPCSF(N,IJA,ISP(IJAR),ISP(LINKA),IFL,NZMAX,NZU,ISP(
     *IJU),ISP(IUT),ISP(JL),ISP(IFC),ISP(LEVL),ISP(IPT))
      IF(IERR.EQ.3)THEN
      ISP(1)=ANFREE-SPCN(NZU)
      ISP(3)=ISP(1)-SCRN(NZU,SPLOW,SPIUT,SP1,SPMARK)
      ENDIF
      IF(IERR.NE.0)THEN
      RETURN
      ENDIF
      IF(LOWER)THEN
      IF(AILAST-RATIO*(NZU+N).LT.IUT)THEN
      CALLPCICPY(NZA,ISP(IJAR),ISP(IJU+NZU+(2+SPMARK)*N))
      IJAR=IJU+NZU+(2+SPMARK)*N
      CALLPCICPY(NZA,ISP(LINKA),ISP(IJAR+NZA))
      LINKA=IJAR+NZA
      IF(AILAST-RATIO*(NZU+N)-(2+SPMARK)*N.LT.LINKA+
     *NZA)THEN
      IERR=3
      ISP(1)=ANFREE-SPCN(NZU)
      ISP(3)=ISP(1)-SCRN(NZU,SPLOW,SPIUT,SP1,SPMARK)
      RETURN
      ENDIF
      ENDIF
      ELSE
      IF(AILAST-(2+SPMARK)*N-RATIO*(NZU+N).LT.IJU+NZU)THEN
      IERR=3
      ISP(1)=ANFREE-SPCN(NZU)
      ISP(3)=ISP(1)-SCRN(NZU,SPLOW,SPIUT,SP1,SPMARK)
      RETURN
      ENDIF
      ENDIF
      ENDIF
      UD=ALAST-NZU
      ROW=UD-N
      JL=IJU+NZU
      IFC=JL+N
      MARK=IFC+SPMARK*N
      ISP(2)=(JL+RATIO-2)/RATIO+1
      ISP(1)=UD-ISP(2)
      NSP1=ISP(1)-SCRN(NZU,SPLOW,SPIUT,SP1,SPMARK)
      ISP(3)=NSP1
      IF(NSP1.LT.0)THEN
      IERR=3
      RETURN
      ENDIF
      CALLPCPCNF(MODIFY,N,IJA,ISP(IJAR),ISP(LINKA),ISP(IJU),A,
     *RSP(UD),ISP(JL),ISP(IFC),ISP(MARK),RSP(ROW))
      RETURN
      END
