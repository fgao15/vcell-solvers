      SUBROUTINEPCRSFP(N,IJA,A,RHS,ISP,RSP,IC,C,NBLACK,D2I,
     *NZRS,IJRS,RS,RSRHS,Y,IMN,ISCR,RSNADR,NSP1)
      IMPLICITDOUBLEPRECISION(A-H,O-Z)
      INTEGERN,IJA(*),ISP(*),IC,C,NBLACK,D2I,NZRS,IJRS,RS,
     *RSRHS,Y,IMN,ISCR,RSNADR,NSP1
      DOUBLEPRECISIONA(*),RHS(*),RSP(*)
      INTEGERIERR,ITMAX,ITEST,KMAX,IFL,IPRE,PBLK,LUDONE,IBLK,
     *MNEED,ITS,RSDONE,NOVERF,RED1,RED2,IERR2,IFRMAT
      COMMON/PCCOM1/IERR,ITMAX,ITEST,KMAX,IFL,IPRE,PBLK,
     *LUDONE,IBLK,MNEED,ITS,RSDONE,NOVERF,RED1,RED2,IERR2,
     *IFRMAT
      SAVE/PCCOM1/
      INTEGERIPRE1,IPRE2,RATIO
      COMMON/PCCOM3/IPRE1,IPRE2,RATIO
      SAVE/PCCOM3/
      INTEGERINADR,NZRSMX,MARK,ROW,FIC,AILAST,NZR,NRED,
     *NSP,NADR
      INTEGERPRMSP,SCRN
      PRMSP(NZRS)=(2*N+NZRS+IC+RATIO-2)/RATIO+
     1NZRS+N+MAX(NBLACK,N-NBLACK)
      SCRN(NZR,NZRS)=
     1MAX((NZR-NZRS+RATIO-1)/RATIO-(NZRS+N+MAX(NBLACK,N-NBLACK)),
     2MIN(NBLACK,N-NBLACK))
      NADR=ISP(2)
      NSP=NADR+ISP(1)-1
      IF(RSDONE.EQ.0)THEN
      NZR=IJA(N+1)-1
      C=IC+N
      NADR=(C+2*N+NZR+RATIO-1)/RATIO+1
      INADR=C+N
      IF(NADR.GT.NSP)THEN
      NZRS=NZR
      NBLACK=N/2
      IMN=PRMSP(NZRS)
      ISCR=SCRN(NZR,NZRS)
      MNEED=IMN+ISCR-NSP
      IERR=10
      RETURN
      ENDIF
      IF(RED1.NE.0.AND.RED2.NE.0)THEN
      CALLPCCRED(N,IJA,NBLACK,ISP(C),ISP(IC),ISP(INADR))
      IF(IERR.NE.0)RETURN
      ELSE
      CALLPCRSRP(N,IJA,NBLACK,ISP(C),ISP(IC),ISP(INADR))
      ENDIF
      NRED=N-NBLACK
      AILAST=NSP*RATIO+1
      MARK=AILAST-N
      FIC=MARK-NBLACK
      IJRS=C+N
      NZRSMX=FIC-IJRS
      IF(NZRSMX.LT.0)THEN
      NZRS=NZR
      IMN=PRMSP(NZRS)
      ISCR=SCRN(NZR,NZRS)
      MNEED=IMN+ISCR-NSP
      IERR=10
      RETURN
      ENDIF
      IF(NBLACK.NE.0)THEN
      CALLPCRSPS(N,NZRSMX,NBLACK,ISP(C),ISP(IC),IJA,NZRS,
     *ISP(IJRS),ISP(MARK),ISP(FIC))
      IF(IERR.NE.0)THEN
      NZRS=MAX(NZR,NZRSMX)
      IMN=PRMSP(NZRS)
      ISCR=SCRN(NZR,NZRS)
      MNEED=IMN+ISCR-NSP
      IERR=10
      RETURN
      ENDIF
      ELSE
      NZRS=0
      ENDIF
      INADR=IJRS+NZRS
      NADR=(INADR+RATIO-2)/RATIO+1
      RSNADR=NADR
      D2I=NSP+1-NRED
      RSRHS=D2I-NBLACK
      RS=RSRHS-NZRS
      Y=RS-MAX(NRED,NBLACK)
      NSP1=Y-NADR
      IF(RS-N-NADR.LT.0)THEN
      IMN=PRMSP(NZRS)
      ISCR=SCRN(NZR,NZRS)
      MNEED=IMN+ISCR-NSP
      IERR=10
      RETURN
      ENDIF
      IMN=PRMSP(NZRS)
      ISCR=SCRN(NZR,NZRS)
      MNEED=IMN+ISCR
      ENDIF
      ROW=RS-N
      CALLPCRSPF(N,NBLACK,ISP(C),ISP(IC),IJA,ISP(IJRS),A,RHS,
     *RSP(D2I),RSP(RSRHS),RSP(RS),RSP(ROW))
      RETURN
      END
