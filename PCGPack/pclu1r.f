      SUBROUTINEPCLU1R(MODIFY,N,IJA,A,ISP,RSP,IJL,IJU,LD,U)
      IMPLICITDOUBLEPRECISION(A-H,O-Z)
      LOGICALMODIFY
      INTEGERN,IJA(*),ISP(*),IJL,IJU,LD,U
      DOUBLEPRECISIONA(*),RSP(*)
      INTEGERIERR,ITMAX,ITEST,KMAX,IFL,IPRE,PBLK,LUDONE,IBLK,
     *MNEED,ITS,RSDONE,NOVERF,RED1,RED2,IERR2,IFRMAT
      COMMON/PCCOM1/IERR,ITMAX,ITEST,KMAX,IFL,IPRE,PBLK,
     *LUDONE,IBLK,MNEED,ITS,RSDONE,NOVERF,RED1,RED2,IERR2,
     *IFRMAT
      SAVE/PCCOM1/
      INTEGERIPRE1,IPRE2,RATIO
      COMMON/PCCOM3/IPRE1,IPRE2,RATIO
      SAVE/PCCOM3/
      INTEGERISRT,IJASGN,ISX0,IFORM
      COMMON/PCVERI/ISRT,IJASGN,ISX0,IFORM
      SAVE/PCVERI/
      INTEGERIJLR,IJUR,LDR,UR,
     *ROW,IROW,
     *KNZL,KNZU,ANADR,ANFREE,AINADR,ALAST,AILAST,NZMAX,
     *LEVL,IPT,IUT,NZL,NZU,SPCN,SCRN0,SCRN2,
     *IJL1,IJU1,SPIUT,SPLEVL,SPIPT,SPIROW
      SPCN(KNZL,KNZU)=(KNZL+KNZU+RATIO-1)/RATIO+
     +KNZL+KNZU-N-1
      SCRN0(KNZL,KNZU,SPIUT,SPLEVL,SPIPT,SPIROW)=MAX(
     *(SPIPT+SPLEVL+(2+SPIUT)*MAX(KNZL,KNZU)-
     -SPCN(KNZL,KNZU)+RATIO-1)/RATIO,
     *(MAX(KNZL,KNZU)+SPIROW+RATIO-1)/RATIO+MAX(KNZL,KNZL))
      SCRN2(KNZL,KNZU,SPIROW)=(KNZL+KNZU+SPIROW+
     +RATIO-1)/RATIO+MAX(KNZL,KNZL)
      IF(IFL.EQ.-1)THEN
      SPIUT=0
      SPLEVL=0
      SPIPT=0
      ELSEIF(IFL.GT.0)THEN
      SPIUT=1
      SPLEVL=N
      SPIPT=ISRT*N
      ELSE
      SPIUT=1-ISRT
      SPLEVL=SPIUT*N
      SPIPT=0
      ENDIF
      IF(MODIFY)THEN
      SPIROW=N
      ELSE
      SPIROW=0
      ENDIF
      IF(IJASGN.EQ.0)THEN
      CALLPCIABS(N,IJA)
      ENDIF
      IF(LUDONE.NE.0)THEN
      NZL=ISP(IJL+N)-1
      NZU=ISP(IJU+N)-1
      IJLR=IJU+NZU
      IJUR=IJLR+NZL
      IROW=IJUR+NZU
      LDR=LD-MAX(NZL,NZU)
      UR=LDR-NZU
      ROW=LD
      IF((IROW+SPIROW+RATIO-1)/RATIO-UR.GT.0)THEN
      ISP(3)=ISP(1)-SCRN2(NZL,NZU,SPIROW)
      IERR=3
      RETURN
      ENDIF
      CALLPCSRIZ(N,ISP(IJL),ISP(IJLR))
      CALLPCSRIX(N,ISP(IJL),ISP(IJLR))
      CALLPCSRIZ(N,ISP(IJU),ISP(IJUR))
      CALLPCSRIX(N,ISP(IJU),ISP(IJUR))
      ELSE
      ANADR=ISP(2)
      ANFREE=ISP(1)
      AINADR=(ANADR-1)*RATIO+1
      ALAST=ANADR+ANFREE-1
      AILAST=AINADR+ANFREE*RATIO-1
      IPT=AINADR
      LEVL=IPT+SPIPT
      IUT=LEVL+SPLEVL
      NZMAX=(AILAST-IUT+1)/(2+SPIUT)
      IF(NZMAX.LE.N+1)THEN
      NZL=((IJA(N+1)-1-N)*(1+IFL)+N)/2
      NZU=NZL
      ISP(1)=ANFREE-SPCN(NZL,NZU)
      ISP(3)=ISP(1)-SCRN0(NZL,NZU,SPIUT,SPLEVL,SPIPT,SPIROW)
      IERR=3
      RETURN
      ENDIF
      IJU1=IUT+NZMAX*SPIUT
      IJL1=IJU1+NZMAX
      IF(ISRT.EQ.1)THEN
      CALLPCILUS(N,IJA,IFL,NZMAX,NZL,NZU,ISP(IJL1),
     *ISP(IJU1),ISP(IUT),ISP(LEVL),ISP(IPT))
      ELSE
      CALLPCILUZ(N,IJA,IFL,NZMAX,NZL,NZU,ISP(IJL1),
     *ISP(IJU1),ISP(IUT),ISP(LEVL))
      ENDIF
      IF(IERR.EQ.3)THEN
      ISP(1)=ANFREE-SPCN(NZL,NZU)
      ISP(3)=ISP(1)-SCRN0(NZL,NZU,SPIUT,SPLEVL,SPIPT,SPIROW)
      ENDIF
      IF(IERR.NE.0)THEN
      RETURN
      ENDIF
      NZMAX=MAX(NZL,NZU)
      IJL=AINADR
      IJLR=IJL+NZL
      IJUR=IJLR+NZMAX
      IROW=IJUR+NZU
      LD=ALAST-NZL+1
      LDR=LD-NZMAX
      UR=LDR-NZU
      IF((IROW+SPIROW+RATIO-1)/RATIO-UR.GT.0)THEN
      ISP(1)=ANFREE-SPCN(NZL,NZU)
      ISP(3)=ISP(1)-SCRN0(NZL,NZU,SPIUT,SPLEVL,SPIPT,SPIROW)
      IERR=3
      RETURN
      ENDIF
      CALLPCICPY(NZL,ISP(IJL1),ISP(IJLR))
      CALLPCICPY(NZU,ISP(IJU1),ISP(IJUR))
      ROW=LD
      IJU=IJL+NZL
      U=LD-NZU
      ENDIF
      ISP(2)=(IJU+NZU+RATIO-2)/RATIO+1
      ISP(1)=U+N+1-ISP(2)
      IF(LUDONE.NE.0)THEN
      ISP(3)=ISP(1)-SCRN2(NZL,NZU,SPIROW)
      ELSE
      ISP(3)=ISP(1)-SCRN0(NZL,NZU,SPIUT,SPLEVL,SPIPT,SPIROW)
      ENDIF
      CALLPCILUF(MODIFY,N,IJA,ISP(IJLR),ISP(IJUR),
     *A,RSP(LDR),RSP(UR),ISP(IROW),RSP(ROW))
      CALLPCTRAN(N,ISP(IJLR),RSP(LDR),ISP(IJL),RSP(LD))
      CALLPCTRAN(N,ISP(IJUR),RSP(UR),ISP(IJU),RSP(U))
      RETURN
      END
