      SUBROUTINEPCLUP4(IRB,IBLKSI,LEVP2,N,NP1,NZMAX,HEAD,
     *NZL,NZU,IJL,IJU,IUT,IRSW,LD,U,LEVL,IPT,IPVT,ROW,SUM,
     *LEV0,TACC2)
      IMPLICITDOUBLEPRECISION(A-H,O-Z)
      INTEGERIRB,IBLKSI,LEVP2,N,NP1,NZMAX,HEAD(*),NZL,NZU,
     *IJL(*),IJU(*),IUT(*),IPVT(*),IRSW(*),LEVL(*),IPT(*),LEV0
      DOUBLEPRECISIONLD(*),U(*),ROW(*),SUM(*),TACC2
      INTEGERIERR,ITMAX,ITEST,KMAX,IFL,IPRE,PBLK,LUDONE,IBLK,
     *MNEED,ITS,RSDONE,NOVERF,RED1,RED2,IERR2,IFRMAT
      COMMON/PCCOM1/IERR,ITMAX,ITEST,KMAX,IFL,IPRE,PBLK,
     *LUDONE,IBLK,MNEED,ITS,RSDONE,NOVERF,RED1,RED2,IERR2,
     *IFRMAT
      SAVE/PCCOM1/
      INTEGERI,IROW,J,IPVTI,IPVTJ,ONE,RBASEI,RBASEJ
      DOUBLEPRECISIONPV,SUMI,SUMJ
      ONE=1
      DO1I=1,IBLKSI
      IPVT(I)=I
      IRSW(IRB+I)=IRB+I
1     CONTINUE
      IROW=IRB
      DO3I=1,IBLKSI
      IROW=IROW+1
      IPVTI=IPVT(I)
      RBASEI=(IPVTI-1)*N
      SUMI=TACC2*SUM(IPVTI)
      DO5J=I+1,IBLKSI
      IPVTJ=IPVT(J)
      RBASEJ=(IPVTJ-1)*N
      SUMJ=TACC2*SUM(IPVTJ)
      IF(ABS(ROW(RBASEI+IROW)-SUMI).LT.
     *ABS(ROW(RBASEJ+IROW)-SUMJ))THEN
      IPVT(I)=IPVTJ
      IPVT(J)=IPVTI
      IPVTI=IPVTJ
      RBASEI=RBASEJ
      SUMI=SUMJ
      ENDIF
5     CONTINUE
      PV=ROW(RBASEI+IROW)-SUMI
      IPVTI=IPVT(I)
      IF(PV.EQ.0.0D0)THEN
      IERR=5
      IERR2=IROW
      NZL=NZL*N/(IRB+I)
      NZU=NZU*N/(IRB+I)
      RETURN
      ENDIF
      PV=1.0D0/PV
      RBASEI=RBASEI+1
      CALLPCLUP5(NP1,IROW,HEAD(IPVTI),NZMAX,PV,IPT(RBASEI),
     *LEVL(RBASEI),ROW(RBASEI),NZL,NZU,IJL,IJU,
     *IUT,LD,U,LEV0)
      IF(IERR.NE.0)THEN
      RETURN
      ENDIF
      CALLDSCAL(NZU+1-IJU(IROW),PV,U(IJU(IROW)),ONE)
      DO9J=I+1,IBLKSI
      IPVTJ=IPVT(J)
      RBASEJ=(IPVTJ-1)*N+1
      IF(ROW(RBASEJ+IROW-1).NE.0.0D0)THEN
      CALLPCLUP3(IROW,LEVP2,NP1,IJU,IUT,U,LEVL(RBASEJ),
     *IPT(RBASEJ),ROW(RBASEJ),SUM(IPVTJ),
     *IRB+1,IRB+IBLKSI)
      ENDIF
9     CONTINUE
3     CONTINUE
      RETURN
      END
