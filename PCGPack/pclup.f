      SUBROUTINEPCLUP(MODIFY,N,IJA,A,ISP,RSP,IJL,IJU,LD,U,IRSW
     *)
      IMPLICITDOUBLEPRECISION(A-H,O-Z)
      LOGICALMODIFY
      INTEGERN,IJA(*),ISP(*),IJL,IJU,LD,U,IRSW
      DOUBLEPRECISIONA(*),RSP(*)
      INTEGERIERR,ITMAX,ITEST,KMAX,IFL,IPRE,PBLK,LUDONE,IBLK,
     *MNEED,ITS,RSDONE,NOVERF,RED1,RED2,IERR2,IFRMAT
      COMMON/PCCOM1/IERR,ITMAX,ITEST,KMAX,IFL,IPRE,PBLK,
     *LUDONE,IBLK,MNEED,ITS,RSDONE,NOVERF,RED1,RED2,IERR2,
     *IFRMAT
      SAVE/PCCOM1/
      INTEGERIPRE1,IPRE2,RATIO
      COMMON/PCCOM3/IPRE1,IPRE2,RATIO
      SAVE/PCCOM3/
      INTEGERROW,IBLKN,IBLKS,MAXBLK,IPVT,LDR,UR,IJLR,IJUR,
     *HEAD,SUM,ANADR,ANFREE,AINADR,ALAST,AILAST,IUT,NZMAX,
     *LEVL,IPT,NZL,NZU,SPCN,SCRN
      INTEGERKNZL,KNZU,KIBLKN,KMXBLK
      SPCN(KNZL,KNZU)=(N+KNZL+KNZU+RATIO-1)/RATIO+KNZL+KNZU-N
     *-1
      SCRN(KNZL,KNZU,KIBLKN,KMXBLK)=(3*MAX(KNZL,KNZU)-(KNZL+KNZU)+
     *KIBLKN+KMXBLK*2*(N+1)+RATIO-1)/RATIO+KMXBLK*(N+1)+ABS(KNZL
     *-KNZU)
      ANADR=ISP(2)
      ANFREE=ISP(1)
      AINADR=(ANADR-1)*RATIO+1
      ALAST=ANADR+ANFREE
      AILAST=AINADR+ANFREE*RATIO
      IRSW=AINADR
      IBLKS=IRSW+N
      IF(IBLKS+N.GT.AILAST)THEN
      MAXBLK=IBLK
      IF(IBLK.LT.1)THEN
      MAXBLK=2
      ENDIF
      NZL=((IJA(N+1)-1-N)*(1+IFL)+N)/2
      NZU=NZL
      IBLKN=N/MAXBLK
      ISP(1)=ANFREE-SPCN(NZL,NZU)
      ISP(3)=ISP(1)-SCRN(NZL,NZU,IBLKN,MAXBLK)
      IERR=3
      RETURN
      ENDIF
      CALLPCIBLK(N,IBLK,IJA,IBLKN,MAXBLK,ISP(IBLKS))
      IJLR=IBLKS+IBLKN
      IPVT=AILAST-MAXBLK
      HEAD=IPVT-MAXBLK
      LEVL=HEAD-N*MAXBLK
      IPT=LEVL-N*MAXBLK
      ROW=(IPT+RATIO-1)/RATIO-N*MAXBLK
      SUM=ROW-MAXBLK
      NZMAX=((SUM+N)*RATIO+1-IJLR)/(3+2*RATIO)
      IUT=IJLR+NZMAX
      IJUR=IUT+NZMAX
      LDR=SUM-NZMAX
      UR=LDR-NZMAX
      IF(NZMAX.LT.N+1)THEN
      IERR=3
      NZL=((IJA(N+1)-1-N)*(1+IFL))/2+N+1
      NZU=NZL
      ISP(1)=ANFREE-SPCN(NZL,NZU)
      ISP(3)=ISP(1)-SCRN(NZL,NZU,IBLKN,MAXBLK)
      RETURN
      ENDIF
      CALLPCLUPF(MODIFY,N,IJA,A,IFL,NZMAX,MAXBLK,IBLKN,ISP(
     *IBLKS),NZL,NZU,ISP(IJLR),ISP(IJUR),ISP(IRSW),RSP(LDR),RSP(
     *UR),ISP(IUT),ISP(LEVL),ISP(IPT),ISP(IPVT),ISP(HEAD),RSP(SUM)
     *,RSP(ROW))
      LD=ALAST-NZL
      U=LD-NZU
      IJL=IBLKS
      IJU=IJL+NZL
      ISP(2)=(IJU+NZU+RATIO-2)/RATIO+1
      IF(IERR.EQ.3)THEN
      ISP(1)=ANFREE-SPCN(NZL,NZU)
      ISP(3)=ISP(1)-SCRN(NZL,NZU,IBLKN,MAXBLK)
      RETURN
      ELSE
      ISP(1)=U+N+1-ISP(2)
      ISP(3)=ISP(1)-SCRN(NZL,NZU,IBLKN,MAXBLK)
      ENDIF
      IF(IERR.NE.0)THEN
      RETURN
      ENDIF
      CALLPCRCPR(NZL,RSP(LDR),RSP(LD))
      CALLPCRCPR(NZU-N-1,RSP(UR+N+1),RSP(U+N+1))
      CALLPCICPY(NZL,ISP(IJLR),ISP(IJL))
      CALLPCICPY(NZU,ISP(IJUR),ISP(IJU))
      RETURN
      END
